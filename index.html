<html>

<head>

	<title>Fractal</title>

	<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	
	
	<meta charset="UTF-8">
	<script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
	<script language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
  
	
	<link rel="stylesheet" type="text/css" href="_assets/css/main.css" />
	
	

</head>

<body>
	
	<header>
		<h1>Fractal Examples</h1>
		
		<p id="label">Μηχανική Γνώσης και Συστήματα Γνώσης</p>
	</header>
	
	<br>
	
	<div>
		
		<div id="canv"></div>
		
		<button id="change">change fractal</button>
	
		<div>
	
	</div>


	<footer>Created by icsd13189 on 11/2019</footer>
</body>

</html>


<script>

$(document).ready(function() {



var s =2;


	
let sketch = function(p) {
	var angle = 0;
	var slider;
	var canvas;
	var leng = 400;
	var w,h;
	
	let sandpiles;
	
	p.setup = function() {
			
		//Screen adaptive
		if(p.displayWidth>700){
			w=700;
		} else{
			w= p.displayWidth-10;
		}
		if(p.displayHeight>550){
			h=550;
		} else{
			h= p.displayHeight;
		}
		
		sandpiles = Array(w).fill().map(() => Array(h).fill(0));
		sandpiles[w/2][h/2] = 10000;
		
		canvas = p.createCanvas(w,h);
		canvas.parent('canv');
	};

	p.draw = function() {
		
		p.background(51);
		
		if(s==0){
			angle = p.map(p.mouseX, 0, p.width, 0.1, p.TWO_PI);
			p.stroke(255);
			p.translate(p.width/2, p.height);
			p.branch(170);
		}
		
		if(s==1){
			//console.log(p.floor(p.map(p.mouseX, 0, p.width, 3, 5)));
			p.divide(p.width / 2 - leng / 2, p.height / 2 + leng * p.sqrt(3) / 4, leng, 1, p.floor(p.map(p.mouseX, 0, p.width, 3, 5)));
		}
		
		
		if(s==2){
			p.circle(p.width/2,p.height/2,300,p.map(p.mouseX, 0, p.width, 7,12),p.map(p.mouseY, 0, p.height, 6,16));
		}
		
		//not
		if(s==-10){
		    p.renderSand();	
			for(var k=0;k<50;k++){
				p.topple();
			}
		}
	};
	
	//CIRCLE
	p.circle = function(x,y,d,lvlx,lvly) {
		p.stroke(255);
		p.noFill();
		p.ellipse(x,y,d,d);
		
		if(d > lvlx){
			console.log("d: "+d);
			console.log("x: "+lvlx);
			console.log("y: "+lvly);
			
			p.circle(x+d/2,y,d/2,lvlx,lvly);
			p.circle(x-d/2,y,d/2,lvlx,lvly);
			
			if(d > lvly && lvly > 11){
				p.circle(x,y+d/2,d/2,lvlx,lvly);
			}
			if(d > lvly && lvly < 7){
				p.circle(x,y-d/2,d/2,lvlx,lvly);
			}
		}
	
	}
	
	//SANDPILES
    p.topple = function(){
    
      let nextpiles = Array(w).fill().map(() => Array(h).fill(0));       
      for(var i=0;i<w;i++){
          for(var j=0;j<h;j++){
            var num = sandpiles[i][j];
            if(num < 4){
              nextpiles[i][j] = sandpiles[i][j];
            }
            if(num >= 4){
              nextpiles[i][j] += (num - 4);
			  if(i+1<w)
				nextpiles[i+1][j]++;
              if(i-1>=0)
				nextpiles[i-1][j]++;
              if(j+1<h)
				nextpiles[i][j+1]++;
              if(j-1>=0)
				nextpiles[i][j-1]++;
            }
          }
      }
	  let tmp = sandpiles;
      sandpiles = nextpiles;
	  nextpiles = tmp;
      
    }
  
	p.renderSand = function() {
		p.loadPixels();
        for(var i=0;i<w;i++){
          for(var j=0;j<h;j++){
            
            var num = sandpiles[i][j];
            var index = (i+j*w)*4;
            var R=255;G=0;B=0;A=255;
            
            if(num == 0){
              R=255;G=255;B=0;A=255;
            } else if(num == 1){
              //col = p.color(255,0,255);
              R=0;G=185;B=63;A=255;
            }else if(num == 2){
              //col = p.color(0,255,255);
              R=0;G=104;B=255;A=255;
            }else if(num == 3){
              //col = p.color(255,255,255);
              R=122;G=0;B=229;A=255;
            }
            
            p.pixels[index] = R;
            p.pixels[index+1] = G;
            p.pixels[index+2] = B;
            p.pixels[index+3] = A;
          }
        }
        p.updatePixels();
	}
	
	
	//TREES
	p.branch = function(len) {
		p.line(0, 0, 0, -len);
		p.translate(0, -len);
		if (len > 4) {
			p.push();
			p.rotate(angle);
			p.branch(len * 0.67);
			p.pop();
			p.push();
			p.rotate(-angle);
			p.branch(len * 0.67);
			p.pop();
		}
	};
	
	//SIERPINSKI
	p.divide = function(x, y, l, lvl, max) {
		if (lvl == max) {
			p.tri(x, y, l);
		} else {
			p.divide(x, y, l / 2, lvl + 1, max);
			p.divide(x + l / 2, y, l / 2, lvl + 1, max);
			p.divide(x + l / 4, y - l * p.sqrt(3) / 4, l / 2, lvl + 1, max);
		}
	};
	
	p.tri = function(x, y, l) {
		p.triangle(x, y, x + l / 2, y - l * p.sqrt(3) / 2, x + l, y);
	}
	
};
let myp5 = new p5(sketch);
	

$("#change").click(function() {

	if(s == 0){
		s=1;
	}else{
		s=0;
	}
	
});










});

</script>