<html>

<head>

	<title>Fractal</title>

	<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	
	
	<meta charset="UTF-8">
	<script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
	<script language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
  
	
	<link rel="stylesheet" type="text/css" href="_assets/css/main.css" />
	
	

</head>

<body>
	
	<header>
		<h1>Fractal Examples</h1>
		
		<p id="label">Μηχανική Γνώσης και Συστήματα Γνώσης</p>
	</header>
	
	<br>
	
	<div>
		
		<div id="canv"></div>
		
		<button id="change">change fractal</button>
	
		<div>
	
	</div>


	<footer>Created by icsd13189 on 11/2019</footer>
</body>

</html>


<script>

$(document).ready(function() {



var s =2;

PointObj = function(){
		var x,y;
}
	
let sketch = function(p) {
	var angle = 0;
	var slider;
	var canvas;
	var leng = 400;
	var w,h;
	
	var maxdraw = 17;
	var count = 0;
	var P = new PointObj();
	var Q = new PointObj();
	
	let sandpiles;
	
	p.setup = function() {
			
		//Screen adaptive
		if(p.displayWidth>700){
			w=700;
		} else{
			w= p.displayWidth-10;
		}
		if(p.displayHeight>550){
			h=550;
		} else{
			h= p.displayHeight;
		}
		
		sandpiles = Array(w).fill().map(() => Array(h).fill(0));
		sandpiles[w/2][h/2] = 10000;
		
		canvas = p.createCanvas(w,h);
		canvas.parent('canv');
	};

	p.draw = function() {
		
		p.background(51);
		p.frameRate(20);
		
		//TREES
		if(s==0){
			angle = p.map(p.mouseX, 0, p.width, 0.1, p.TWO_PI);
			p.stroke(255);
			p.translate(p.width/2, p.height);
			p.branch(170);
		}
		
		//SIERPINSKI
		else if(s==1){
			//console.log(p.floor(p.map(p.mouseX, 0, p.width, 3, 5)));
			p.divide(p.width / 2 - leng / 2, p.height / 2 + leng * p.sqrt(3) / 4, leng, 1, p.floor(p.map(p.mouseX, 0, p.width, 3, 5)));
		}
		
		//SIERPINSKI CIRCLES
		else if(s==2){
			p.circle(p.width/2,p.height/2,300,p.map(p.mouseX, 0, p.width, 40,120),p.map(p.mouseY, 0, p.height, 6,16));
		}
		
		//DRAGON CURVE
		else if(s==3){
			console.log(count);
			p.smooth();
			p.noFill();
			p.frameRate(1);

			P.x = 350; P.y = 150;
			Q.x = 450; Q.y = 450;

			p.strokeWeight(1);
			p.stroke(255);
			p.background(51);
			p.dragon(P, Q, count);
			if(count<17){
				count++;
			}
		}
		
		//not
		if(s==-10){
		    p.renderSand();	
			for(var k=0;k<50;k++){
				p.topple();
			}
		}
	};
	
	
	//DRAGON CURVE
	p.dragon = function(a, b, n){
		var c = new PointObj();
		var xx, yy;
		xx = b.x - a.x;
		yy = -(b.y - a.y);
		c.x = a.x + (xx + yy) / 2;
		c.y = b.y + (xx + yy) / 2;
		if (n <= 0) {
			p.line(a.x, a.y, c.x, c.y);
			p.line(b.x, b.y, c.x, c.y);
		} else {
			p.dragon(a, c, n - 1);
			p.dragon(b, c, n - 1);
		}
	}
	
	
	//SIERPINSKI CIRCLES
	p.circle = function(x,y,d,lvlx,lvly) {
		p.stroke(255);
		p.noFill();
		p.ellipse(x,y,d,d);
		
		if(d > lvlx && lvlx > 3){
			console.log("d: "+d);
			console.log("x: "+lvlx);
			console.log("y: "+lvly);
			
			p.circle(x+d/2,y,d/2,lvlx,lvly);
			p.circle(x-d/2,y,d/2,lvlx,lvly);
			
			if(d > lvlx && lvly > 11){
				p.circle(x,y+d/2,d/2,lvlx,lvly);
			}
			if(d > lvlx && lvly < 7){
				p.circle(x,y-d/2,d/2,lvlx,lvly);
			}
		}
	
	}
	
	//SANDPILES
    p.topple = function(){
    
      let nextpiles = Array(w).fill().map(() => Array(h).fill(0));       
      for(var i=0;i<w;i++){
          for(var j=0;j<h;j++){
            var num = sandpiles[i][j];
            if(num < 4){
              nextpiles[i][j] = sandpiles[i][j];
            }
            if(num >= 4){
              nextpiles[i][j] += (num - 4);
			  if(i+1<w)
				nextpiles[i+1][j]++;
              if(i-1>=0)
				nextpiles[i-1][j]++;
              if(j+1<h)
				nextpiles[i][j+1]++;
              if(j-1>=0)
				nextpiles[i][j-1]++;
            }
          }
      }
	  let tmp = sandpiles;
      sandpiles = nextpiles;
	  nextpiles = tmp;
      
    }
  
	p.renderSand = function() {
		p.loadPixels();
        for(var i=0;i<w;i++){
          for(var j=0;j<h;j++){
            
            var num = sandpiles[i][j];
            var index = (i+j*w)*4;
            var R=255;G=0;B=0;A=255;
            
            if(num == 0){
              R=255;G=255;B=0;A=255;
            } else if(num == 1){
              //col = p.color(255,0,255);
              R=0;G=185;B=63;A=255;
            }else if(num == 2){
              //col = p.color(0,255,255);
              R=0;G=104;B=255;A=255;
            }else if(num == 3){
              //col = p.color(255,255,255);
              R=122;G=0;B=229;A=255;
            }
            
            p.pixels[index] = R;
            p.pixels[index+1] = G;
            p.pixels[index+2] = B;
            p.pixels[index+3] = A;
          }
        }
        p.updatePixels();
	}
	
	
	//TREES
	p.branch = function(len) {
		p.line(0, 0, 0, -len);
		p.translate(0, -len);
		if (len > 4) {
			p.push();
			p.rotate(angle);
			p.branch(len * 0.67);
			p.pop();
			p.push();
			p.rotate(-angle);
			p.branch(len * 0.67);
			p.pop();
		}
	};
	
	//SIERPINSKI
	p.divide = function(x, y, l, lvl, max) {
		if (lvl == max) {
			p.tri(x, y, l);
		} else {
			p.divide(x, y, l / 2, lvl + 1, max);
			p.divide(x + l / 2, y, l / 2, lvl + 1, max);
			p.divide(x + l / 4, y - l * p.sqrt(3) / 4, l / 2, lvl + 1, max);
		}
	};
	
	p.tri = function(x, y, l) {
		p.fill(255);
		p.triangle(x, y, x + l / 2, y - l * p.sqrt(3) / 2, x + l, y);
	}
	
};
let myp5 = new p5(sketch);
	

$("#change").click(function() {
	
	s++;
	if(s == 4){
		s=0;
	}
	
});










});

</script>